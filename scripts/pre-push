#!/bin/bash
#
# Pre-push hook that runs tests before allowing push
# This prevents pushing code that breaks tests
#

set -e

echo "ğŸ” Running pre-push checks..."

# Check if we have uv available
if ! command -v uv &> /dev/null; then
    echo "âŒ uv is not installed. Please install uv first."
    exit 1
fi

# Run code formatting check
echo "ğŸ“ Checking code formatting with black..."
if ! uv run black --check .; then
    echo "âŒ Code formatting check failed. Run 'uv run black .' to fix formatting."
    exit 1
fi

# Run import sorting check  
echo "ğŸ“¦ Checking import sorting with isort..."
if ! uv run isort --check-only .; then
    echo "âŒ Import sorting check failed. Run 'uv run isort .' to fix imports."
    exit 1
fi

# Run linting
echo "ğŸ” Running linting with flake8..."
if ! uv run flake8; then
    echo "âŒ Linting failed. Please fix the issues."
    exit 1
fi

# Run type checking
echo "ğŸ”§ Running type checking with mypy..."
if ! uv run mypy .; then
    echo "âŒ Type checking failed. Please fix the type issues."
    exit 1
fi

# Run tests
echo "ğŸ§ª Running tests with pytest..."
if ! uv run pytest; then
    echo "âŒ Tests failed. Please fix the failing tests before pushing."
    exit 1
fi

echo "âœ… All pre-push checks passed! Ready to push."